#!/bin/env python3
# -*- coding: utf-8 -*
'''

感谢CurtinLV提供的其他脚本供我参考
感谢aburd ch大佬的指导抓包
项目名称:xF_DiDi_DZDZ_Sign.py
Author: 一风一燕
功能：滴滴app多走多赚签到
Date: 2021-11-23
cron: 9 1,22 * * * 10000.py
new Env('电信任务');




'''

mobile = '18122893373'
dx_cookie = ''

'''


=================================以下代码不懂不要随便乱动=================================


'''
tokens =''
id = ''
try:
    import requests
    import json,sys,os,re
    import time,datetime,base64
    from urllib.parse import quote, unquote
except Exception as e:
    print(e)

requests.packages.urllib3.disable_warnings()


pwd = os.path.dirname(os.path.abspath(__file__)) + os.sep
path = pwd + "env.sh"
today = datetime.datetime.now().strftime('%Y-%m-%d')
mor_time ='08:00:00.00000000'
moringtime = '{} {}'.format (today, mor_time)









def printT(s):
    print("[【{0}】]: {1}".format(datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S"), s))
    sys.stdout.flush()


def getEnvs(label):
    try:
        if label == 'True' or label == 'yes' or label == 'true' or label == 'Yes':
            return True
        elif label == 'False' or label == 'no' or label == 'false' or label == 'No':
            return False
    except:
        pass
    try:
        if '.' in label:
            return float(label)
        elif '&' in label:
            return label.split('&')
        elif '@' in label:
            return label.split('@')
        else:
            return int(label)
    except:
        return label

##############      在pycharm测试ql环境用，实际用下面的代码运行      #########

# with open(path, "r+", encoding="utf-8") as f:
#    ck = f.read()
#    tokens = ck
#    if "Didi_jifen_token" in ck:
#        r = re.compile (r'Didi_jifen_token="(.*?)"', re.M | re.S | re.I)
#        tokens = r.findall(ck)
#        tokens = tokens[0].split ('&')
#        if len (tokens) == 1:
#            Didi_jifen_token = tokens[0]
#            tokens = ''
#            # print(tokens)
#            # tokens = cookies[3]
#        else:
#            pass
#    printT ("已获取并使用ck环境 token")



########################################################################

# if "Didi_jifen_token" in os.environ:
#     print(len (os.environ["Didi_jifen_token"]))
#     if len (os.environ["Didi_jifen_token"]) > 419:
#         tokens = os.environ["Didi_jifen_token"]
#         # tokens = tokens.split ('&')
#         # cookies = temporary[0]
#         printT ("已获取并使用Env环境Didi_jifen_token")
#     else:
#         Didi_jifen_token = os.environ["Didi_jifen_token"]
# else:
#     print("检查变量Didi_jifen_token是否已填写")
#
# if "exchange_numb" in os.environ:
#     tokens = os.environ["exchange_numb"]
#     printT ("已获取并使用Env环境exchange_numb")
# else:
#     print("变量exchange_numb未填写，默认兑换1000健康豆")

## 获取通知服务
class msg(object):
    def __init__(self, m=''):
        self.str_msg = m
        self.message()
    def message(self):
        global msg_info
        printT(self.str_msg)
        try:
            msg_info = "{}\n{}".format(msg_info, self.str_msg)
        except:
            msg_info = "{}".format(self.str_msg)
        sys.stdout.flush()           #这代码的作用就是刷新缓冲区。
                                     # 当我们打印一些字符时，并不是调用print函数后就立即打印的。一般会先将字符送到缓冲区，然后再打印。
                                     # 这就存在一个问题，如果你想等时间间隔的打印一些字符，但由于缓冲区没满，不会打印。就需要采取一些手段。如每次打印后强行刷新缓冲区。
    def getsendNotify(self, a=0):
        if a == 0:
            a += 1
        try:
            url = 'https://gitee.com/curtinlv/Public/raw/master/sendNotify.py'
            response = requests.get(url)
            if 'curtinlv' in response.text:
                with open('sendNotify.py', "w+", encoding="utf-8") as f:
                    f.write(response.text)
            else:
                if a < 5:
                    a += 1
                    return self.getsendNotify(a)
                else:
                    pass
        except:
            if a < 5:
                a += 1
                return self.getsendNotify(a)
            else:
                pass
    def main(self):
        global send
        cur_path = os.path.abspath(os.path.dirname(__file__))
        sys.path.append(cur_path)
        if os.path.exists(cur_path + "/sendNotify.py"):
            try:
                from sendNotify import send
            except:
                self.getsendNotify()
                try:
                    from sendNotify import send
                except:
                    printT("加载通知服务失败~")
        else:
            self.getsendNotify()
            try:
                from sendNotify import send
            except:
                printT("加载通知服务失败~")
        ###################
msg().main()
nowtime = int(round(time.time() * 1000))


if tokens != '':
    # if "Didi_jifen_token" in tokens:
        # r = re.compile (r'Didi_jifen_token="(.*?)"', re.M | re.S | re.I)
        # tokens = r.findall (ck)
        tokens = tokens.split ('&')
        # print(tokens)
        if len (tokens) == 1:
            Didi_jifen_token = tokens[0]

        else:
            pass


#获取UA
def get_h5_headers(mobile):
    base64_mobile = str(base64.b64encode(mobile[5:11].encode('utf-8')), 'utf-8').strip(r'=+') + "!#!" + str(
        base64.b64encode(mobile[0:5].encode('utf-8')), 'utf-8').strip(r'=+')
    print(base64_mobile)
    return "CtClient;9.2.0;Android;10;MI 9;" + base64_mobile

#签到
def sign(UA,mobile):
    try:
        url = f'https://wapside.189.cn:9001/api/home/sign'
        heards = {
            "user-agent": f"{UA}",
            # "Referer": "https://page.udache.com/",
            # "Host": "res.xiaojukeji.com",
            # "Origin": "https://page.udache.com",
            # "Accept-Language": "zh-CN,zh-Hans;q=0.9",
            # "ticket":f"{Didi_jifen_token}",
            "Content-Type":"application/json;charset=UTF-8",
        }
        data = r'{"encode":"015e918cfb4510308f961094e649956a5d37381fbe431200e2834f5a39bbf72f855db7c633e6c486fc79918ca23cd1f8249f49accfb69884f17ffde4d024d2f5640e7cecc4a4381f434d9b3f19412e1c"}'
        print(data)
        response = requests.post (url=url, headers=heards,verify=False,data=data)
        result = response.json()
        print (result)


    except Exception as e:
        print (e)
        msg ("【账号{0}】执行签到失败".format (mobile))

#喂食
def feed(UA,mobile):
    try:
        i = 0
        while True:
            url = f'https://wapside.189.cn:9001/jt-sign/paradise/food'
            heards = {
                "user-agent": f"{UA}",
                # "Referer": "https://wapside.189.cn:9001/resources/dist/signInActivity.html?cmpid=cmpid=signin-myjhnew-khd-jt&ticket=dbbcc79199ed99647d759bf25454c0431e5a73c1ec6a409c769fb3ad92903939&version=9.3.0",
                # "Host": "wapside.189.cn:9001",
                # "Origin": "https://wapside.189.cn:9001",
                # "Accept-Language": "zh-CN,zh-Hans;q=0.9",
                # "Cookie":f"{dx_cookie}",
                # "Content-Type":"application/json;charset=utf-8",
                # "Accept":"application/json, text/plain, */*",
            }
            data = r'{"para":"9e71816c5d2cdaf7f326b49f9cee5dabc1c3c997ede350b526f16bf8e2b8ace52ce0804111dc420d9f8d63362a7bbe2cc9ea22e4b26a548449713c1bd9fe2bdcf9a29636efe7402604e7ba800934fd25b9634498d2e4ddabb916fce951a28960952f9a2c6ee97e6c82ba64d981c3937ee2ee257049e5dbb730569f5d6ab17325"}'
            # print(data)
            response = requests.post (url=url, headers=heards,verify=False,data=data)
            result = response.json()
            print (result)
            resoultCode = result['resoultCode']
            if resoultCode == '0':
                printT("【账号{0}喂食成功，消耗10金豆】".format(mobile))
                i += 1
                time.sleep(2)
            elif resoultCode == '1':
                msg("【账号{0}】今天已达到最大喂食次数".format(mobile))
                if i !=0:
                    total = i * 10
                    msg("【账号{0}】本次一共喂食{1}金豆".format(mobile,total))
                break
            else:
                msg ("【账号{0}】不足10金豆，退出喂食】".format (mobile))
                break
    except Exception as e:
        print (e)
        msg ("【账号{0}】喂食失败,可能是body过期".format (mobile))

#开盲盒
def openBlindbox(UA,mobile):
    try:
        url = f'https://wapside.189.cn:9001/jt-sign/blindbox/openBlindbox'
        heards = {
            "user-agent": f"{UA}",
            # "Referer": "https://wapside.189.cn:9001/resources/dist/signInActivity.html?cmpid=cmpid=signin-myjhnew-khd-jt&ticket=dbbcc79199ed99647d759bf25454c0431e5a73c1ec6a409c769fb3ad92903939&version=9.3.0",
            # "Host": "wapside.189.cn:9001",
            # "Origin": "https://wapside.189.cn:9001",
            # "Accept-Language": "zh-CN,zh-Hans;q=0.9",
            # "Cookie": f"{dx_cookie}",
            # "Content-Type": "application/json;charset=utf-8",
            # "Accept": "application/json, text/plain, */*",
        }
        data = r'{"para":"43a058b4c4f475776ee748c5aea900d1319f73eeff6f12f5313a5bbc664b6c9e553e4af81df9d0d1fece19dd96b828c9d6b5390b4a6b8e7d05f15f58b919ff1e518f4e277f8ef22e12d28fb0aff44e634c285392499f2776f0108fcaa4b62373d66e3d679f31431f02723eee07b66ef413bb16261189cd90e1befcbf06f2db5c63ef2486be0350df40b2098cd6606ebd033a37809cc208ccad0ddcce4a2bee74706650c7ca5e1ca1c0ca17fd34289b4ac45c74159231f03df39d83ffe3c9c16e366fd3d04a0c4f275bed2e48e95a671a534bf285aa3c5801c978ee557506e3299df50cee07a1ae08cdebaf4eab1a985ff2a73480a3add6620b9b05915c968414"}'
        response = requests.post (url=url, headers=heards,verify=False,data=data)
        result = response.json()
        print (result)
        errmsg = result['msg']
        if "抽取盲盒成功" in errmsg:
            msg("【账号{0}】抽取盲盒成功".format(mobile))
    except Exception as e:
        print (e)
        msg ("【账号{0}】抽取盲盒失败,可能是body过期".format (mobile))

#查看云盘
def cheak_cloudpan(UA,mobile):
    try:
        url = f'https://wapside.189.cn:9001/jt-sign/paradise/polymerize'
        heards = {
            "user-agent": f"{UA}",
            # "Referer": "https://wapside.189.cn:9001/resources/dist/signInActivity.html?cmpid=cmpid=signin-myjhnew-khd-jt&ticket=dbbcc79199ed99647d759bf25454c0431e5a73c1ec6a409c769fb3ad92903939&version=9.3.0",
            # "Host": "wapside.189.cn:9001",
            # "Origin": "https://wapside.189.cn:9001",
            # "Accept-Language": "zh-CN,zh-Hans;q=0.9",
            # "Cookie": f"{dx_cookie}",
            # "Content-Type": "application/json;charset=utf-8",
            # "Accept": "application/json, text/plain, */*",
        }
        data = r'{"para":"3ccb85a64791e9e58c00db1fb283339a2678c58dc48e75160b4aa50caad050f383fdd0ca4dfb8cec96b241bf6255f97ae1b5c8fe4aff80a6506e2949e9678fdd02af519ebe3991183084d3b9dce662b10c075c1373b4514fba32763dda100c7a718a8c89cd62d1ef2e952c6798fd28ad7103a3a433eb5ea754e39bb9b91a8e368f59ea224f52dbb2d3cd5ec1560cd4bf4271feb939bfc9582f5da35b2588db150193f777d0703067181b816531b560c06b4e49de73aeb4c15aac4df0b4c21c7f85cbf8fc47972454daec622ba34da52ab965b2b7cac9d02b8e09b25e2d9e9c6d1fced50f18657a6eeafd0753336af8c15242e11efd9aa986dd51f9b00b50652d"}'
        response = requests.post (url=url, headers=heards,verify=False,data=data)
        result = response.json()
        print (result)
        resoultMsg = result['resoultMsg']
        if "成功" in resoultMsg:
            printT("【账号{0}】正在执行【查看我的云盘】任务，等待5秒".format(mobile))
            time.sleep(5)
            msg("【账号{0}】【查看我的云盘】任务已完成,获得10金豆".format(mobile))
    except Exception as e:
        print (e)
        msg ("【账号{0}】执行【查看我的云盘】任务失败,可能是body过期".format (mobile))

#登录任务
def login(UA,mobile):
    try:

        url = f'https://wapside.189.cn:9001/jt-sign/paradise/receiveReward'
        heards = {
            "user-agent": f"{UA}",
            # "Referer": "https://wapside.189.cn:9001/resources/dist/signInActivity.html?cmpid=cmpid=signin-myjhnew-khd-jt&ticket=dbbcc79199ed99647d759bf25454c0431e5a73c1ec6a409c769fb3ad92903939&version=9.3.0",
            # "Host": "wapside.189.cn:9001",
            # "Origin": "https://wapside.189.cn:9001",
            # # "Accept-Language": "zh-CN,zh-Hans;q=0.9",
            # # "Cookie": f"{dx_cookie}",
            # "Content-Type": "application/json;charset=utf-8",
            # "Accept": "application/json, text/plain, */*",
            # "Content-Length":"1035"
        }
        data = r'{"para":"68961df77f7cecee84aa2848398bf08985341efb6146dfe9a4c1cc57fc742b95a831da21c893800ad2029f2dd3079cb0656f76c8c9cb7fdc3c04d661146e85299df10c31b8920cb5a1d07b57a3bde3f122ed2dfd2179b65b3cf9d99bc96ddf47016d1d5f02f59956507b44430db9f0b524b45110d59de10413c5e16237f2c393342e72fe2c1d3cedda9f019bde5c76d477b742e3e3b04093af9176d733921daaabca9fc16edb9550f8986cd777aed3baf41c1ed2ec596a0917ba8c9aeed578d14a3347b7329e83081a2832ecd5c59d8ce338125fa550c406db17fc2584b8803b74fa85c6cf08860128ed698bc63b7501d474f2ae47356fb380407e44daa4097475e55d1817a5920440a3127e738236ecf2fd728da49e9958c521433cb09edd6787cd90f66568600035344fd779151b393f1586cb8e769f9c5a32aaf3b50614d09a126805d6139693f36fdfd05f057f21c6fb527aba61b582ec512dc4d595241571746a698d1916446d0517f701690440df835c061e3d3a4a22d7475f77233da4a9abbc33ae6bef844ff2e110c94a9ecb30b954fbf8a6f913b1dcab0a101324444573a03eb4fe4af1b0bb0a749578459a3f9b55f305c2bba88f1691c4bd3cd4f6566285ff3d0cdf99b603f1d24f51181d48b31788d0b80c51669be65e07c281e34aed5182462070160c6d8e4d91401af0aa4773effe936360e68c30c989056295"}'
        response = requests.post (url=url, headers=heards,verify=False,data=data)
        result = response.json()
        print (result)
        resoultMsg = result['resoultMsg']
        if "成功" in resoultMsg:
            printT("【账号{0}】正在执行【登录】任务，等待5秒".format(mobile))
            time.sleep(5)
            msg("【账号{0}】【登录】任务已完成,获得5金豆".format(mobile))
    except Exception as e:
        print (e)
        msg ("【账号{0}】执行【登录】任务失败,可能是body过期".format (mobile))

#摇树领好礼
def tree(UA,mobile):
    try:
        url = f'https://wapside.189.cn:9001/jt-sign/paradise/polymerize'
        heards = {
            "user-agent": f"{UA}",
            # "Referer": "https://wapside.189.cn:9001/resources/dist/signInActivity.html?cmpid=cmpid=signin-myjhnew-khd-jt&ticket=dbbcc79199ed99647d759bf25454c0431e5a73c1ec6a409c769fb3ad92903939&version=9.3.0",
            # "Host": "wapside.189.cn:9001",
            # "Origin": "https://wapside.189.cn:9001",
            # "Accept-Language": "zh-CN,zh-Hans;q=0.9",
            # "Cookie": f"{dx_cookie}",
            # "Content-Type": "application/json;charset=utf-8",
            # "Accept": "application/json, text/plain, */*",
        }
        data = r'{"para":"3a26d7ccee47a4fc784395389c014013b3d9becae2b3e3a03844592885450cf9b5477af1c060ac9ee6524814ea5f57dc787146a1fa83adf28f2ab2b84e8e55545ba703f7ec70bb46949e0a2bb5df0c5d8696a04bbabb4be9a28300511e1745c631fbf107b742c4eb0b451d2d4ada912d2581299eabfc4716aa3de2be47ad98186906505181688a4302044120f7a527b8af1154b5312ca2a3049c1c80986ba79d8b86808b3e32cacf38a2a922bb94e9e0023b360599f779dc81345a35a9d18d30d329edae1a624fc835366e17cc2afe1b2e584e827b4e0f3c21c16a15b9e3a9d867302d2d12fc20036610cc9cff8269eb0037e7b44809a35da46ba95a1b078ea3"}'
        response = requests.post (url=url, headers=heards,verify=False,data=data)
        result = response.json()
        print (result)
        resoultMsg = result['resoultMsg']
        if "成功" in resoultMsg:
            printT("【账号{0}】正在执行【摇树领好礼】任务，等待5秒".format(mobile))
            time.sleep(5)
            msg("【账号{0}】【摇树领好礼】任务已完成,获得10金豆".format(mobile))
    except Exception as e:
        print (e)
        msg ("【账号{0}】执行【摇树领好礼】任务失败,可能是body过期".format (mobile))

#浏览生活频道
def look_lifechannel(UA,mobile):
    try:
        url = f'https://wapact.189.cn:9001/common/lifeChannel.do?4peRecvt=5jlEYiTIToHOE5vSzNDR9wO5LUJ72d_4cxxCO9nB57FSwqw0NN6sp9ufmGKGgXpx6K8HySQVwtX1k5aPmvVNjnp0lSTx9ZkIjcdAimw3w7uooQAOc0l01JSVE6SO2EID9LORz4u8yYZp64F3YIstttfESCVqIo9Q_T5O7dUfAYgjsM6Crd6UNypn_xk6fL_0a6OJMTHdM.4rA1TYjwVJe3cOZeUdRjGGlb9JWFkNPdbFNmIEPKhHrH_4id73Urlor_2M7IjGXk8k3YB.Li449vmmGGD4p0WOSbtuu5TuEI7.IH8s.N9lYETf8rCBXIHjPDdccL288qYeOhIk.M7MGOG'
        heards = {
            "user-agent": f"{UA}",
            # "Referer": "https://wapside.189.cn:9001/resources/dist/signInActivity.html?cmpid=cmpid=signin-myjhnew-khd-jt&ticket=dbbcc79199ed99647d759bf25454c0431e5a73c1ec6a409c769fb3ad92903939&version=9.3.0",
            # "Host": "wapside.189.cn:9001",
            # "Origin": "https://wapside.189.cn:9001",
            # "Accept-Language": "zh-CN,zh-Hans;q=0.9",
            # "Cookie": f"{dx_cookie}",
            # "Content-Type": "application/json;charset=utf-8",
            # "Accept": "application/json, text/plain, */*",
        }
        data = r'{"headerInfo": { "functionCode": "lifeChannelLuaTicket"},"requestContent":{"ticket":"$ticket$","type":"1","location":""}}'
        response = requests.post (url=url, headers=heards,verify=False,data=data)
        result = response.json()
        print (result)
        message = result['headerInfo']['message']
        if "成功" in message:
            printT("【账号{0}】正在执行【浏览生活频道】任务，等待5秒".format(mobile))
            time.sleep(5)
            msg("【账号{0}】【浏览生活频道】任务已完成,获得10金豆".format(mobile))
    except Exception as e:
        print (e)
        msg ("【账号{0}】执行【浏览生活频道】任务失败,可能是body过期".format (mobile))


if __name__ == '__main__':
    global msg_info
    print("============脚本只支持青龙新版=============\n")
    print("具体教程以文本模式打开文件，查看顶部教程\n\n")
    print("============执行电信10000脚本==============")

    # if dx_cookie != '':
    # sign(UA,mobile)
    UA = get_h5_headers(mobile)
    feed(UA,mobile)
    openBlindbox (UA,mobile)
    # login(UA, mobile)
    tree(UA, mobile)
    cheak_cloudpan (UA, mobile)



    if "签到" in msg_info:
        send("滴滴多走多赚签到", msg_info)
    elif "过期" in msg_info:
        send("滴滴多走多赚签到", msg_info)
